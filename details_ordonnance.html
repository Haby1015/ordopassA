<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Détails Ordonnance - Pharmacien | OrdoPass</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f5f6fa;
      color: #333;
      line-height: 1.6;
    }

    .container {
      display: flex;
      min-height: 100vh;
    }

    /* Sidebar */
    .sidebar {
      width: 280px;
      background: #2a5298;
      color: white;
      padding: 25px 0;
      position: fixed;
      height: 100vh;
      overflow-y: auto;
      box-shadow: 2px 0 10px rgba(0,0,0,0.1);
    }

    .logo {
      font-size: 26px;
      font-weight: bold;
      text-align: center;
      margin-bottom: 40px;
      padding: 0 25px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .logo span {
      color: #ffd700;
    }

    .menu {
      display: flex;
      flex-direction: column;
    }

    .menu a {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 15px 25px;
      color: white;
      text-decoration: none;
      transition: all 0.3s;
      border-left: 4px solid transparent;
      font-size: 15px;
    }

    .menu a:hover {
      background: rgba(255, 255, 255, 0.15);
      border-left-color: #ffd700;
      transform: translateX(5px);
    }

    .menu a i {
      width: 22px;
      text-align: center;
      font-size: 18px;
    }

    .logout {
      margin-top: auto;
      border-top: 1px solid rgba(255,255,255,0.1);
      padding-top: 20px;
    }

    /* Main Area */
    .main {
      flex: 1;
      margin-left: 280px;
      padding: 0;
      background: #f5f6fa;
    }

    .topbar {
      background: white;
      padding: 20px 30px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .title {
      color: #2a5298;
      font-size: 28px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .title i {
      color: #2a5298;
    }

    .user-box {
      display: flex;
      align-items: center;
      gap: 12px;
      font-weight: 500;
      color: #2c3e50;
    }

    .avatar {
      width: 45px;
      height: 45px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid #e0e0e0;
    }

    /* Card */
    .card {
      background: white;
      margin: 25px;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 2px 20px rgba(0,0,0,0.1);
    }

    /* Meta Information */
    .meta-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      margin-bottom: 20px;
    }

    .meta-col h4 {
      color: #2a5298;
      font-size: 0.9em;
      font-weight: 600;
      margin-bottom: 5px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .meta-col p {
      font-size: 1.1em;
      font-weight: 500;
      color: #2c3e50;
      margin-bottom: 15px;
      padding: 8px 0;
      border-bottom: 1px solid #f1f3f4;
    }

    /* Status Badges */
    .status-badge {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 0.85em;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .status-en-attente {
      background: #fff3cd;
      color: #856404;
    }

    .status-en-cours {
      background: #d1ecf1;
      color: #0c5460;
    }

    .status-termine {
      background: #d4edda;
      color: #155724;
    }

    .status-annule {
      background: #f8d7da;
      color: #721c24;
    }

    /* Table Styles */
    .table-wrap {
      overflow-x: auto;
      border-radius: 8px;
      border: 1px solid #e1e5e9;
    }

    .medic-table {
      width: 100%;
      border-collapse: collapse;
      background: white;
    }

    .medic-table th {
      background: #f8f9fa;
      padding: 15px 20px;
      text-align: left;
      font-weight: 600;
      color: #2a5298;
      border-bottom: 1px solid #e1e5e9;
      font-size: 0.9em;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .medic-table td {
      padding: 15px 20px;
      border-bottom: 1px solid #f1f3f4;
      color: #2c3e50;
    }

    .medic-table tr:last-child td {
      border-bottom: none;
    }

    .medic-table tr:hover {
      background: #f8f9fa;
    }

    /* Actions */
    .details-actions {
      display: flex;
      gap: 15px;
      margin-top: 30px;
      padding-top: 25px;
      border-top: 1px solid #e1e5e9;
      flex-wrap: wrap;
    }

    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.95em;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      min-height: 44px;
    }

    .btn.primary {
      background: linear-gradient(135deg, #2a5298, #1e3c72);
      color: white;
    }

    .btn.primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(42, 82, 152, 0.3);
    }

    .btn.view {
      background: #17a2b8;
      color: white;
    }

    .btn.view:hover {
      background: #138496;
      transform: translateY(-2px);
    }

    .btn.danger {
      background: #e74c3c;
      color: white;
    }

    .btn.danger:hover {
      background: #c0392b;
      transform: translateY(-2px);
    }

    .btn.secondary {
      background: #fff;
      color: #2a5298;
      border: 2px solid #2a5298;
    }

    .btn.secondary:hover {
      background: #f8f9fa;
      transform: translateY(-2px);
    }

    /* Alert Messages */
    .alert {
      padding: 15px 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      display: none;
    }

    .alert.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .alert.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .alert.warning {
      background: #fff3cd;
      color: #856404;
      border: 1px solid #ffeaa7;
    }

    /* Responsive */
    @media (max-width: 1024px) {
      .meta-row {
        grid-template-columns: 1fr;
        gap: 20px;
      }
    }

    @media (max-width: 768px) {
      .sidebar {
        width: 70px;
      }
      
      .sidebar .logo span,
      .sidebar .menu a span {
        display: none;
      }
      
      .main {
        margin-left: 70px;
      }
      
      .details-actions {
        flex-direction: column;
      }
      
      .btn {
        width: 100%;
        justify-content: center;
      }
      
      .topbar {
        padding: 15px 20px;
      }
      
      .title {
        font-size: 24px;
      }
      
      .card {
        margin: 15px;
        padding: 20px;
      }
    }

    @media (max-width: 480px) {
      .medic-table {
        font-size: 0.9em;
      }
      
      .medic-table th,
      .medic-table td {
        padding: 10px 12px;
      }
      
      .user-box div {
        display: none;
      }
    }

    /* Loading State */
    .loading {
      opacity: 0.6;
      pointer-events: none;
    }

    .loading::after {
      content: "";
      position: absolute;
      top: 50%;
      left: 50%;
      width: 20px;
      height: 20px;
      border: 2px solid #f3f3f3;
      border-top: 2px solid #2a5298;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: translate(-50%, -50%) rotate(0deg); }
      100% { transform: translate(-50%, -50%) rotate(360deg); }
    }

    /* Print Styles */
    @media print {
      .sidebar, .topbar, .details-actions {
        display: none !important;
      }
      
      .main {
        margin-left: 0;
      }
      
      .card {
        box-shadow: none;
        margin: 0;
        padding: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="logo">
        <i class="fa-solid fa-prescription-bottle-medical"></i> <span>ORDO</span>PASS
      </div>
      <nav class="menu">
        <a href="pharmacien_dashboard.html">
          <i class="fa-solid fa-file-medical"></i> <span>Ordonnances</span>
        </a>
        <a href="pharmacien_medecins.html">
          <i class="fa-solid fa-user-doctor"></i> <span>Médecins</span>
        </a>
        <a href="pharmacien_stock.html">
          <i class="fa-solid fa-boxes-stacked"></i> <span>Gestion Stock</span>
        </a>
        <a href="pharmacien_messagerie.html">
          <i class="fa-solid fa-comment-medical"></i> <span>Messagerie</span>
        </a>
        <a href="pharmacien_parametres.html">
          <i class="fa-solid fa-gear"></i> <span>Paramètres</span>
        </a>
        <a href="#" class="logout" id="logoutBtn">
          <i class="fa-solid fa-right-from-bracket"></i> <span>Déconnexion</span>
        </a>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="main">
      <header class="topbar">
        <div class="title">
          <i class="fa-solid fa-file-prescription"></i> Détails de l'ordonnance
        </div>
        <div class="user-box">
          <img class="avatar" src="https://i.pravatar.cc/80?img=12" alt="Avatar">
          <div id="userName">Pharmacie Centrale</div>
        </div>
      </header>

      <!-- Alert Messages -->
      <div class="alert success" id="successAlert" style="display: none;">
        <i class="fa-solid fa-circle-check"></i> Opération effectuée avec succès
      </div>
      <div class="alert error" id="errorAlert" style="display: none;">
        <i class="fa-solid fa-circle-exclamation"></i> Une erreur est survenue
      </div>

      <section class="card">
        <!-- Meta Information -->
        <div class="meta-row">
          <div class="meta-col" id="metaLeft">
            <h4><i class="fa-solid fa-ticket"></i> N° Ticket</h4>
            <p id="ticket">ORD-2024-001234</p>
            <h4><i class="fa-solid fa-user"></i> Patient</h4>
            <p id="patient">Awa Diop (35 ans)</p>
            <h4><i class="fa-solid fa-circle-info"></i> Statut</h4>
            <p id="statut">
              <span class="status-badge status-en-attente">En attente</span>
            </p>
          </div>
          <div class="meta-col" id="metaRight">
            <h4><i class="fa-solid fa-calendar"></i> Date / Heure</h4>
            <p id="date">15 mars 2024 - 10:30</p>
            <h4><i class="fa-solid fa-user-doctor"></i> Médecin</h4>
            <p id="medecin">Dr. Marie Diallo</p>
            <h4><i class="fa-solid fa-hospital"></i> Hôpital</h4>
            <p id="hopital">Hôpital Principal de Dakar</p>
          </div>
        </div>

        <!-- Medications Table -->
        <div style="margin-top: 25px;">
          <h3 style="color:#2a5298; margin-bottom:15px; display: flex; align-items: center; gap: 10px;">
            <i class="fa-solid fa-pills"></i> Médicaments prescrits
          </h3>
          <div class="table-wrap">
            <table class="medic-table" id="medicTable">
              <thead>
                <tr>
                  <th>Médicament</th>
                  <th>Posologie</th>
                  <th>Quantité</th>
                  <th>Disponibilité</th>
                </tr>
              </thead>
              <tbody id="medicBody">
                <!-- Les médicaments seront chargés dynamiquement -->
              </tbody>
            </table>
          </div>
        </div>

        <!-- Actions -->
        <div class="details-actions">
          <button class="btn view" id="markProcessing">
            <i class="fa-solid fa-play"></i> Marquer comme en cours
          </button>
          <button class="btn primary" id="confirmGive">
            <i class="fa-solid fa-check"></i> Confirmer la remise au patient
          </button>
          <button class="btn danger" id="cancelOrd">
            <i class="fa-solid fa-times"></i> Annuler l'ordonnance
          </button>
          <a href="pharmacien_dashboard.html" class="btn secondary">
            <i class="fa-solid fa-arrow-left"></i> Retour au tableau de bord
          </a>
        </div>
      </section>
    </main>
  </div>

  <script>
    // Données de démonstration
    const ordonnanceData = {
      id: "ORD-2024-001234",
      patient: "Awa Diop (35 ans)",
      statut: "en_attente",
      date: "15 mars 2024 - 10:30",
      medecin: "Dr. Marie Diallo",
      hopital: "Hôpital Principal de Dakar",
      medicaments: [
        { nom: "Paracétamol 500mg", posologie: "1 comprimé 3 fois par jour", quantite: "30 comprimés", disponible: true },
        { nom: "Amoxicilline 1g", posologie: "1 comprimé 2 fois par jour", quantite: "14 comprimés", disponible: true },
        { nom: "Ibuprofène 400mg", posologie: "1 comprimé si douleur", quantite: "20 comprimés", disponible: false },
        { nom: "Vitamine C 500mg", posologie: "1 comprimé par jour", quantite: "30 comprimés", disponible: true }
      ]
    };

    // Éléments DOM
    const medicBody = document.getElementById('medicBody');
    const markProcessingBtn = document.getElementById('markProcessing');
    const confirmGiveBtn = document.getElementById('confirmGive');
    const cancelOrdBtn = document.getElementById('cancelOrd');
    const successAlert = document.getElementById('successAlert');
    const errorAlert = document.getElementById('errorAlert');
    const statutElement = document.getElementById('statut');

    // Initialisation
    document.addEventListener('DOMContentLoaded', function() {
      loadOrdonnanceData();
      setupEventListeners();
      updateActionsVisibility();
    });

    function loadOrdonnanceData() {
      // Remplir les informations de base
      document.getElementById('ticket').textContent = ordonnanceData.id;
      document.getElementById('patient').textContent = ordonnanceData.patient;
      document.getElementById('date').textContent = ordonnanceData.date;
      document.getElementById('medecin').textContent = ordonnanceData.medecin;
      document.getElementById('hopital').textContent = ordonnanceData.hopital;

      // Mettre à jour le statut
      updateStatusDisplay();

      // Charger les médicaments
      loadMedicaments();
    }

    function loadMedicaments() {
      medicBody.innerHTML = '';
      
      ordonnanceData.medicaments.forEach(medic => {
        const row = document.createElement('tr');
        
        const disponibiliteIcon = medic.disponible ? 
          '<i class="fa-solid fa-check" style="color: #27ae60;"></i>' : 
          '<i class="fa-solid fa-times" style="color: #e74c3c;"></i>';
        
        const disponibiliteText = medic.disponible ? 'En stock' : 'Rupture';
        const disponibiliteClass = medic.disponible ? 'status-termine' : 'status-annule';
        
        row.innerHTML = `
          <td>
            <div style="font-weight: 600;">${medic.nom}</div>
            ${!medic.disponible ? '<div style="font-size: 0.85em; color: #e74c3c; margin-top: 4px;">Rupture de stock</div>' : ''}
          </td>
          <td>${medic.posologie}</td>
          <td>${medic.quantite}</td>
          <td>
            <span class="status-badge ${disponibiliteClass}" style="font-size: 0.8em;">
              ${disponibiliteIcon} ${disponibiliteText}
            </span>
          </td>
        `;
        
        medicBody.appendChild(row);
      });
    }

    function setupEventListeners() {
      // Marquer comme en cours
      markProcessingBtn.addEventListener('click', function() {
        if (confirm('Marquer cette ordonnance comme en cours de traitement ?')) {
          setLoadingState(true);
          
          // Simulation d'appel API
          setTimeout(() => {
            ordonnanceData.statut = 'en_cours';
            updateStatusDisplay();
            updateActionsVisibility();
            showAlert('success', 'Ordonnance marquée comme en cours de traitement');
            setLoadingState(false);
          }, 1000);
        }
      });

      // Confirmer la remise
      confirmGiveBtn.addEventListener('click', function() {
        if (confirm('Confirmer la remise des médicaments au patient ?')) {
          setLoadingState(true);
          
          // Vérifier la disponibilité de tous les médicaments
          const tousDisponibles = ordonnanceData.medicaments.every(medic => medic.disponible);
          
          if (!tousDisponibles) {
            showAlert('error', 'Impossible de confirmer : certains médicaments sont en rupture de stock');
            setLoadingState(false);
            return;
          }
          
          // Simulation d'appel API
          setTimeout(() => {
            ordonnanceData.statut = 'termine';
            updateStatusDisplay();
            updateActionsVisibility();
            showAlert('success', 'Remise au patient confirmée avec succès');
            setLoadingState(false);
          }, 1000);
        }
      });

      // Annuler l'ordonnance
      cancelOrdBtn.addEventListener('click', function() {
        if (confirm('Êtes-vous sûr de vouloir annuler cette ordonnance ? Cette action est irréversible.')) {
          setLoadingState(true);
          
          // Simulation d'appel API
          setTimeout(() => {
            ordonnanceData.statut = 'annule';
            updateStatusDisplay();
            updateActionsVisibility();
            showAlert('success', 'Ordonnance annulée avec succès');
            setLoadingState(false);
          }, 1000);
        }
      });

      // Déconnexion
      document.getElementById('logoutBtn').addEventListener('click', function(e) {
        e.preventDefault();
        if (confirm('Êtes-vous sûr de vouloir vous déconnecter ?')) {
          // Redirection vers la page de connexion
          window.location.href = 'login.html';
        }
      });
    }

    function updateStatusDisplay() {
      const statusMap = {
        'en_attente': { text: 'En attente', class: 'status-en-attente' },
        'en_cours': { text: 'En cours', class: 'status-en-cours' },
        'termine': { text: 'Terminé', class: 'status-termine' },
        'annule': { text: 'Annulé', class: 'status-annule' }
      };
      
      const status = statusMap[ordonnanceData.statut];
      statutElement.innerHTML = `<span class="status-badge ${status.class}">${status.text}</span>`;
    }

    function updateActionsVisibility() {
      // Masquer/montrer les boutons selon le statut
      switch (ordonnanceData.statut) {
        case 'en_attente':
          markProcessingBtn.style.display = 'flex';
          confirmGiveBtn.style.display = 'flex';
          cancelOrdBtn.style.display = 'flex';
          break;
        case 'en_cours':
          markProcessingBtn.style.display = 'none';
          confirmGiveBtn.style.display = 'flex';
          cancelOrdBtn.style.display = 'flex';
          break;
        case 'termine':
        case 'annule':
          markProcessingBtn.style.display = 'none';
          confirmGiveBtn.style.display = 'none';
          cancelOrdBtn.style.display = 'none';
          break;
      }
    }

    function showAlert(type, message) {
      const alert = type === 'success' ? successAlert : errorAlert;
      alert.querySelector('span').textContent = message;
      alert.style.display = 'flex';
      
      setTimeout(() => {
        alert.style.display = 'none';
      }, 5000);
    }

    function setLoadingState(loading) {
      const buttons = document.querySelectorAll('.btn');
      buttons.forEach(btn => {
        btn.disabled = loading;
        if (loading) {
          btn.classList.add('loading');
        } else {
          btn.classList.remove('loading');
        }
      });
    }

    // Fonction pour récupérer l'ID de l'ordonnance depuis l'URL
    function getOrdonnanceIdFromURL() {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get('id');
    }

    // Fonction pour charger les données depuis une API (exemple)
    async function loadOrdonnanceFromAPI(ordonnanceId) {
      try {
        setLoadingState(true);
        // const response = await fetch(`/api/ordonnances/${ordonnanceId}`);
        // const data = await response.json();
        // ordonnanceData = data;
        // loadOrdonnanceData();
      } catch (error) {
        showAlert('error', 'Erreur lors du chargement des données');
      } finally {
        setLoadingState(false);
      }
    }
  </script>
</body>
</html>